#!/usr/bin/env bash

function usage() {
    echo "Usage: $0 OPENING [CLOSING [file*]]"
}

if [[ $# -lt 1 ]]; then
   usage
   exit 1
fi

opening="$1"
closing="$2"
if [[ $# -gt 2 ]]; then
    has_files=true
fi
shift; shift

delimiter="/"
opening="${opening//\//\\\/}"
closing="${closing//\//\\\/}"

o="$opening"
c="$closing"

if [[ "$closing" ]]; then
    command="awk '/${opening}/ { found=1; } found { print } /${closing}/ { found=0; }'"
else
    command="awk '/${opening}/ { found=1; } found { print }'"
fi

if [[ "$has_files" ]]; then
    eachfile "$@" -- $command
else
    eval $command
fi
