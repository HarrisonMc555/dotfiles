#!/usr/bin/env bash

function usage() {
    echo "Usage: $0 OPENING [CLOSING [file*]]"
}

if [[ $# -lt 1 ]]; then
   usage
   exit 1
fi

opening="$1"
closing="$2"
if [[ $# -gt 2 ]]; then
    has_files=true
fi
shift; shift

opening="${opening//\//\\\/}"
closing="${closing//\//\\\/}"

if [[ "$closing" ]]; then
    command="awk '/${closing}/ { found=0; } /${opening}/ { found=1; } found { print }'"
else
    # shellcheck disable=2089
    command="awk '/${opening}/ { found=1; } found { print }'"
fi

if [[ "$has_files" ]]; then
    # shellcheck disable=2090 disable=2086
    for file in "$@"; do
        eval $command "$file"
    done
else
    # shellcheck disable=2086
    eval $command
fi
